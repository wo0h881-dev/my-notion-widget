<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>리디 스타일 수집기</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f5f5f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .search-box { width: 100%; max-width: 500px; display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        input:focus { border-color: #1f8ce6; }
        button { padding: 12px 20px; background: #1f8ce6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #results { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 600px; }
        .book-card { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; text-align: center; position: relative; }
        .book-card img { width: 100%; border-radius: 5px; margin-bottom: 8px; aspect-ratio: 2/3; object-fit: cover; }
        .tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color: white; font-size: 10px; padding: 3px 7px; border-radius: 4px; }
        .book-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px; line-height: 1.2; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="query" placeholder="소설 또는 웹소설 제목 입력" onkeyup="if(window.event.keyCode==13){search()}">
        <button onclick="search()">검색</button>
    </div>
    <div id="results"></div>

    <script>
        const GAS_URL = '여기에_GAS_URL_넣기'; 
        const PD_URL = 'https://script.google.com/macros/s/AKfycbxLzF3JjjJCjbzEfGmDd_6gXhqhwtvkCioowe_x6qhuWcp8W9_m8_fATHM_lGUb2MXn/exec';

        async function search() {
            const query = document.getElementById('query').value;
            const resultsDiv = document.getElementById('results');
            if(!query) return;
            
            resultsDiv.innerHTML = '검색 중...';

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                
                resultsDiv.innerHTML = '';
                data.items.forEach(item => {
                    const highResImg = item.image ? item.image.replace('type=m1', 'type=m140') : 'https://via.placeholder.com/140x200?text=No+Cover';
                    
                    // 제목에 '웹소설'이나 '시리즈' 등이 포함되어 있는지 확인
                    const isWebNovel = item.description?.includes('웹소설') || item.link?.includes('naver') || !item.isbn;
                    const typeTag = isWebNovel ? '웹소설' : '도서';

                    const card = document.createElement('div');
                    card.className = 'book-card';
                    card.innerHTML = `
                        <div class="tag">${typeTag}</div>
                        <img src="${highResImg}">
                        <div class="book-title">${item.title.replace(/<[^>]*>?/gm, '')}</div>
                        <div style="font-size:11px; color:#888;">${item.author.replace(/<[^>]*>?/gm, '')}</div>
                    `;
                    card.onclick = () => sendToNotion(item, highResImg);
                    resultsDiv.appendChild(card);
                });
            } catch (e) {
                resultsDiv.innerHTML = '에러: ' + e.message;
            }
        }

        async function sendToNotion(item, img) {
            if(!confirm('노션에 등록할까요?')) return;
            await fetch(PD_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: item.title.replace(/<[^>]*>?/gm, ''),
                    author: item.author.replace(/<[^>]*>?/gm, ''),
                    publisher: item.publisher?.replace(/<[^>]*>?/gm, '') || '웹소설 플랫폼',
                    cover: img
                })
            });
            alert('등록 완료!');
        }
    </script>
</body>
</html>
