<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¦¬ë”” ìŠ¤íƒ€ì¼ ìˆ˜ì§‘ê¸°</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f5f5f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .search-box { width: 100%; max-width: 500px; display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; outline: none; }
        input:focus { border-color: #1f8ce6; }
        button { padding: 12px 20px; background: #1f8ce6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #results { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 600px; }
        .book-card { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; text-align: center; position: relative; overflow: hidden; }
        .book-card img { width: 100%; border-radius: 5px; margin-bottom: 8px; aspect-ratio: 2/3; object-fit: cover; background: #eee; }
        .tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); color: white; font-size: 10px; padding: 3px 7px; border-radius: 4px; z-index: 10; }
        .book-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px; line-height: 1.2; text-align: left; }
        .book-author { font-size: 11px; color: #888; text-align: left; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="query" placeholder="ì†Œì„¤ ë˜ëŠ” ì›¹ì†Œì„¤ ì œëª© ì…ë ¥" onkeyup="if(window.event.keyCode==13){search()}">
        <button onclick="search()">ê²€ìƒ‰</button>
    </div>
    <div id="results"></div>

    <script>
        // ğŸš€ ë³¸ì¸ì˜ URLë¡œ ê¼­ ë°”ê¿”ì£¼ì„¸ìš”!
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbw9koywAYC-VpOGxtjowahzQAkBdLWWrxo_upX2nV0qsNwWBsjV7Z-iBVwUwY3l7Cyi/exec'; 
        const PD_URL = 'https://eofhox7tlqmz7kv.m.pipedream.net';

        async function search() {
            const query = document.getElementById('query').value;
            const resultsDiv = document.getElementById('results');
            if(!query) return;
            
            resultsDiv.innerHTML = 'ê²€ìƒ‰ ì¤‘...';

            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                
                resultsDiv.innerHTML = '';
                
                if(!data.items || data.items.length === 0) {
                    resultsDiv.innerHTML = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }

                data.items.forEach(item => {
                    // ğŸ” [ì•ˆì „ ì¥ì¹˜] ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ ì²˜ë¦¬
                    let highResImg = 'https://via.placeholder.com/140x200?text=No+Cover';
                    if (item.image) {
                        highResImg = item.image.replace('type=m1', 'type=m140');
                    }
                    
                    // ì œëª©ê³¼ ì €ì í´ë¦¬ë‹ (HTML íƒœê·¸ ì œê±°)
                    const cleanTitle = item.title ? item.title.replace(/<[^>]*>?/gm, '') : 'ì œëª© ì—†ìŒ';
                    const cleanAuthor = item.author ? item.author.replace(/<[^>]*>?/gm, '') : 'ì €ì ë¯¸ìƒ';

                    // ì›¹ì†Œì„¤ ì—¬ë¶€ íŒë‹¨
                    const isWebNovel = item.description?.includes('ì›¹ì†Œì„¤') || item.link?.includes('naver') || !item.isbn;
                    const typeTag = isWebNovel ? 'ì›¹ì†Œì„¤' : 'ë„ì„œ';

                    const card = document.createElement('div');
                    card.className = 'book-card';
                    card.innerHTML = `
                        <div class="tag">${typeTag}</div>
                        <img src="${highResImg}" onerror="this.src='https://via.placeholder.com/140x200?text=Error'">
                        <div class="book-title">${cleanTitle}</div>
                        <div class="book-author">${cleanAuthor}</div>
                    `;
                    card.onclick = () => sendToNotion(cleanTitle, cleanAuthor, item.publisher, highResImg);
                    resultsDiv.appendChild(card);
                });
            } catch (e) {
                resultsDiv.innerHTML = 'ì—ëŸ¬ ë°œìƒ: ' + e.message;
            }
        }

        async function sendToNotion(title, author, publisher, img) {
            if(!confirm(`[${title}] ë…¸ì…˜ì— ë“±ë¡í• ê¹Œìš”?`)) return;
            
            try {
                await fetch(PD_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        author: author,
                        publisher: publisher ? publisher.replace(/<[^>]*>?/gm, '') : 'ì›¹ì†Œì„¤ í”Œë«í¼',
                        cover: img
                    })
                });
                alert('ë…¸ì…˜ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (e) {
                alert('ë“±ë¡ ì‹¤íŒ¨: ' + e.message);
            }
        }
    </script>
</body>
</html>

