<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì›¹ì†Œì„¤ & ë„ì„œ ìˆ˜ì§‘ê¸°</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f5f5f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .search-box { width: 100%; max-width: 500px; display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        button { padding: 12px 20px; background: #1f8ce6; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #results { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; width: 100%; max-width: 600px; }
        .book-card { background: white; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; text-align: center; transition: 0.2s; }
        .book-card:hover { transform: translateY(-5px); }
        .book-card img { width: 100%; border-radius: 5px; margin-bottom: 8px; aspect-ratio: 2/3; object-fit: cover; }
        .book-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px; }
    </style>
</head>
<body>

    <div class="search-box">
        <input type="text" id="query" placeholder="ì†Œì„¤ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        <button onclick="search()">ê²€ìƒ‰</button>
    </div>
    <div id="results"></div>

    <script>
        // ğŸš€ ì´ ë¶€ë¶„ì„ ì‹¤ì œ ì£¼ì†Œë¡œ ê¼­ ë°”ê¿”ì£¼ì„¸ìš”!
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbw8fBy-2DyjrZwwpMSWZ2Z68KzwjmWT9PEAOlkXrbkvXouoOJqoCpKj6WVzAnxQJKKQ/exec'; 
        const PD_URL = 'https://eofhox7tlqmz7kv.m.pipedream.net';

        async function search() {
            const query = document.getElementById('query').value;
            const resultsDiv = document.getElementById('results');
            if(!query) return alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”');
            
            resultsDiv.innerHTML = 'ê²€ìƒ‰ ì¤‘...';

            try {
                // GASë¥¼ í†µí•´ ë„¤ì´ë²„ API í˜¸ì¶œ (CORS ìš°íšŒ)
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                
                resultsDiv.innerHTML = '';
                if(!data.items || data.items.length === 0) {
                    resultsDiv.innerHTML = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
                    return;
                }

                data.items.forEach(item => {
                    // ê³ í™”ì§ˆ ì´ë¯¸ì§€ ì²˜ë¦¬ (ë¦¬ë”” ìŠ¤íƒ€ì¼)
                    const highResImg = item.image.replace('type=m1', 'type=m140');
                    
                    const card = document.createElement('div');
                    card.className = 'book-card';
                    card.innerHTML = `
                        <img src="${highResImg}" alt="cover">
                        <div class="book-title">${item.title.replace(/<[^>]*>?/gm, '')}</div>
                        <div style="font-size:12px; color:#666;">${item.author.replace(/<[^>]*>?/gm, '')}</div>
                    `;
                    card.onclick = () => sendToNotion(item, highResImg);
                    resultsDiv.appendChild(card);
                });
            } catch (e) {
                resultsDiv.innerHTML = 'ì—ëŸ¬ ë°œìƒ: ' + e.message;
            }
        }

        async function sendToNotion(item, img) {
            if(!confirm(`[${item.title.replace(/<[^>]*>?/gm, '')}] ë…¸ì…˜ì— ë“±ë¡í• ê¹Œìš”?`)) return;
            
            try {
                await fetch(PD_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: item.title.replace(/<[^>]*>?/gm, ''),
                        author: item.author.replace(/<[^>]*>?/gm, ''),
                        publisher: item.publisher.replace(/<[^>]*>?/gm, '') || 'ì›¹ì†Œì„¤',
                        cover: img
                    })
                });
                alert('ë…¸ì…˜ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (e) {
                alert('ë“±ë¡ ì‹¤íŒ¨: ' + e.message);
            }
        }
    </script>
</body>
</html>
